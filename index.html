<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
</head>
<style>
    #notification {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 200px;
        padding: 20px;
        border-radius: 5px;
        background-color: white;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
    }

    .hidden {
        display: none;
    }
</style>

<body style="background: rgb(202, 116, 116);">
    <h1>Hello World!</h1>
    <div id="notification" class="hidden">
        <p id="message"></p>
        <button id="close-button" onClick="closeNotification()">
            Close
        </button>
        <button id="restart-button" onClick="restartApp()" class="hidden">
            Restart
        </button>
    </div>
    <p id='version'>
        software version:

    </p>
    <p>
        We are using node
        <script>document.write(process.versions.node)</script>,
        Chrome
        <script>document.write(process.versions.chrome)</script>,
        and Electron
        <script>document.write(process.versions.electron)</script>.
    </p>
</body>


<script>
    const { ipcRenderer } = require('electron');
    const version = document.getElementById('version');
    const notification = document.getElementById('notification');
    const message = document.getElementById('message');
    const restartButton = document.getElementById('restart-button');


    ipcRenderer.send('app_version');
    ipcRenderer.on('app_version', (event, arg) => {
        console.log('version:',arg.version)
        //ipcRenderer.removeAllListeners('app_version');
        version.innerHTML = 'Current version: ' + arg.version;
    });

    ipcRenderer.on('update_available', (e) => {
        //ipcRenderer.removeAllListeners('update_available');
        console.log('update_available:',e);
        message.innerHTML = 'A new update is available. Downloading now...';
        notification.classList.remove('hidden');
    });

    ipcRenderer.on('checkNotify', (e) => {
        console.log('checkNotify:',e)
    });

    ipcRenderer.on('update_downloaded', () => {
        //ipcRenderer.removeAllListeners('update_downloaded');
        restartButton.innerHTML = 'Update Downloaded. It will be installed on restart. Restart now?';
        notification.classList.remove('hidden');
    });

    function closeNotification() {
        notification.classList.add('hidden');
    };
    function restartApp() {
        ipcRenderer.send('restart_app');
    };

    
</script>

</html>